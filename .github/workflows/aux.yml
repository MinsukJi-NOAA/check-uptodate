name: Auxiliary checks

on:
  workflow_run:
    workflows: ["Pull request test"]
    types:
      - requested

jobs:
  job1:
    name:  first job
    runs-on: ubuntu-20.04

    steps:
    - name: Checkout codes
      uses: actions/checkout@v2

    - name: Get branch
      run: |
        url="https://api.github.com/repos/ufs-community/ufs-weather-model/branches/develop"
        app="Accept: application/vnd.github.v3+json"
        #ufs_sha=$(curl -sS -H "Accept: application/vnd.github.v3+json" https://api.github.com/repos/ufs-community/ufs-weather-model/branches/develop | ./json_helper.py ufs_sha)
        ufs_sha=$(curl -sS -H "$app" $url | ./json_helper.py ufs_sha)
        echo "ufs sha is $ufs_sha"

    - name: Get repository content of FV3
      run: |
        fv3_sha=$(curl -sS -H "Accept: application/vnd.github.v3+json" https://api.github.com/repos/ufs-community/ufs-weather-model/contents/FV3 | ./json_helper.py fv3_sha)
        echo "fv3 sha is $fv3_sha"

    - name: Get repository content of WW3
      run: |
        ww3_sha=$(curl -sS -H "Accept: application/vnd.github.v3+json" https://api.github.com/repos/ufs-community/ufs-weather-model/contents/WW3 | ./json_helper.py ww3_sha)
        echo "ww3 sha is $ww3_sha"

#    - name: try check run
#      run: |
#        head_sha=$(cat ${GITHUB_EVENT_PATH} | ./json_helper.py check_run)
#        echo $head_sha
#        echo "============================="
#        cat ${GITHUB_EVENT_PATH}
#        echo "============================="
#        comment_body="$(./repo-check.sh MinsukJi-NOAA feature/ci-regional-model)"
#        echo ${comment_body}
#        curl -sS -X POST -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" -H "Accept: application/vnd.github.v3+json" \
#        https://api.github.com/repos/MinsukJi-NOAA/check-uptodate/issues/2/comments \
#        -d '{"body": "'"${comment_body}"'"}'
